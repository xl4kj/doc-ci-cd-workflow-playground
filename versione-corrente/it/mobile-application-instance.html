<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>22. Mobile Application Instance &#8212; IT-Wallet Technical Documentation - 1.0.0</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/basic_mod.css?v=9b2032db" />
    <link rel="stylesheet" type="text/css" href="_static/itwallet-override.css?v=63798874" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <script src="_static/js/petite-vue.js"></script>
    <link rel="icon" href="https://avatars.githubusercontent.com/u/15377824?s=48&amp;v=4"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="23. Entity Configurations" href="entity-configurations.html" />
    <link rel="prev" title="21. e-Service PDND" href="e-service-pdnd.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="index.html" title="Go to homepage">IT-Wallet Technical Documentation - 1.0.0</a></h1>
            <a id="source_link" href="https://github.com/italia/eudi-wallet-it-docs">
    
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path fill="white" d="M 244.8,8 C 106.1,8 0,113.3 0,252 c 0,110.9 69.8,205.8 169.5,239.2 12.8,2.3 17.3,-5.6 17.3,-12.1 0,-6.2 -0.3,-40.4 -0.3,-61.4 0,0 -70,15 -84.7,-29.8 0,0 -11.4,-29.1 -27.8,-36.6 0,0 -22.9,-15.7 1.6,-15.4 0,0 24.9,2 38.6,25.8 21.9,38.6 58.6,27.5 72.9,20.9 2.3,-16 8.8,-27.1 16,-33.7 -55.9,-6.2 -112.3,-14.3 -112.3,-110.5 0,-27.5 7.6,-41.3 23.6,-58.9 -2.6,-6.5 -11.1,-33.3 2.6,-67.9 20.9,-6.5 69,27 69,27 20,-5.6 41.5,-8.5 62.8,-8.5 21.3,0 42.8,2.9 62.8,8.5 0,0 48.1,-33.6 69,-27 13.7,34.7 5.2,61.4 2.6,67.9 16,17.7 25.8,31.5 25.8,58.9 0,96.5 -58.9,104.2 -114.8,110.5 9.2,7.9 17,22.9 17,46.4 0,33.7 -0.3,75.4 -0.3,83.6 0,6.5 4.6,14.4 17.3,12.1 C 428.2,457.8 496,362.9 496,252 496,113.3 383.5,8 244.8,8 Z"/>
        </svg>
    
</a>
        

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="defined-terms.html">2. Normative References</a></li>
<li class="toctree-l1"><a class="reference internal" href="defined-terms.html#defined-terms-and-acronyms">3. Defined Terms and Acronyms</a></li>
<li class="toctree-l1"><a class="reference internal" href="defined-terms.html#normative-language-and-conventions">4. Normative Language and Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssi-introduction.html">5. The Digital Identity Wallet Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">6. Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="brand-identity.html">7. IT-Wallet System Brand Identity</a></li>
<li class="toctree-l1"><a class="reference internal" href="functionalities.html">8. Functionalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="trust.html">9. The Infrastructure of Trust</a></li>
<li class="toctree-l1"><a class="reference internal" href="wallet-solution.html">10. Wallet Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="credential-issuer-solution.html">11. Credential Issuer Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="relying-party-solution.html">12. Relying Party Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentic-sources.html">13. Authentic Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="credential-data-model.html">14. Digital Credential Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="credential-issuance.html">15. Digital Credential Issuance</a></li>
<li class="toctree-l1"><a class="reference internal" href="credential-presentation.html">16. Digital Credential Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="credential-revocation.html">17. Digital Credential Lifecycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="backup-restore.html">18. Backup and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="registry-catalogue.html">19. Digital Credentials Catalogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="e-service-pdnd-catalogue.html">20. e-Service PDND Catalogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="e-service-pdnd.html">21. e-Service PDND</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">22. Mobile Application Instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="entity-configurations.html">23. Entity Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">24. Cryptographic Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="security-privacy-considerations.html">25. Security and Privacy Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-retention-policy.html">26. General Log Retention Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="standards.html">27. Technical References</a></li>
<li class="toctree-l1"><a class="reference internal" href="test-plans.html">28. Test Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">29. How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="open-source.html">30. Open Source Releases</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mobile-application-instance">
<h1><span class="section-number">22. </span>Mobile Application Instance<a class="headerlink" href="#mobile-application-instance" title="Link to this heading">¶</a></h1>
<p>The Wallet and Mobile Relying Party Instances share significant similarities, with particular respect to some aspects related to initialization and integrity validation. To eliminate redundancy, this section will use the term <strong>Mobile Application Instance</strong> to collectively refer to both. Within this framework, the <strong>Application Provider</strong> assumes the responsibilities of either the Wallet Provider or the Relying Party Backend, depending on the context.</p>
<section id="mobile-application-instance-initialization">
<h2><span class="section-number">22.1. </span>Mobile Application Instance Initialization<a class="headerlink" href="#mobile-application-instance-initialization" title="Link to this heading">¶</a></h2>
<p>The Initialization flow enables the Mobile Application Instance to register a long-lived key pair, securely stored in an appropriate secure storage within the device, with the Application Provider. This process occurs only after the Application Provider verifies the security and integrity assertion issued by the OS manufacturer.</p>
<p>The flow is displayed in <a class="reference internal" href="#fig-mobileapplication-instance-initialization-flow"><span class="std std-ref">Mobile Application Instance Initialization Sequence Diagram</span></a>, while a step-by-step description is provided below.</p>
<figure class="align-center" id="id1" style="width: 100%">
<span id="fig-mobileapplication-instance-initialization-flow"></span><a class="reference external image-reference" href="https://www.plantuml.com/plantuml/svg/VLFBRjiw4DtpAmQyYvi0xWy4Q94qYpPe2mJfOnN0695ZQM29L3b3j-xNbvHToBQ2R0XuT1vd7huLnQHvw0rcZI4F3INJiIVOnAXD_6tC_uy5mOv732e6dSO4zhjGie02MGfXd15WlyI6UuAxSUpPeN8Cy114CJYQ63YESCxuH7kuKoNH0_pkyK4EK5I1_sHC7Des4OLptgd5OuexzfJWFRej1J_n6xSrfYPyywwuti1dpC5re1q1pjpQ4-zGfw8nvJd2xpjoM-3DHF2qOqSm4AbCXO433ta08PSJwnuI_SoSQA2WyXmm-4fzgJV0H80xv1wRdewE9UiDF1M90WLhGwppidEsgPVo794VA52gzHawVJr6dwkUpYJczcQ9-xGVDRO9nuuTVCJaVs6Y6brWH4vmPMrthAwtj5-FkR5s1PVLn3jhhm-jYyRqcZ9ymtQXgzWMWNyPKQKsudgce6kFYkiEfOEtuBabqQkfnHLSIgpWCkprwI2hhZ7rFNgSph8IS5wNjS-XYJbuq0YJtO4vZtb10EFft6lUxxoMrP9QYyjvl782Fx1dlpY1vTUbqIdkQrtKYyQhvx3S-yMTrKq-KSkYQT8kFsICGSXS7fwdnT-iY6IXT0CFWPLBtZy73SdEaSWcz-QMWiz3_nS0"><img alt="_images/application_instance_initialization.svg" src="_images/application_instance_initialization.svg" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22.1 </span><span class="caption-text">Mobile Application Instance Initialization Sequence Diagram</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Step 1</strong>: The User starts the Mobile Application Instance for the first time.</p>
<p><strong>Step 2</strong>: The Mobile Application Instance:</p>
<blockquote>
<div><ul class="simple">
<li><p>Checks whether the device meets the minimum security requirements.</p></li>
<li><p>Checks if the Key Attestation API is available.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Federation Check</strong>: The Mobile Application Instance needs to check if the Application Provider is part of the Federation, obtaining its protocol-specific Metadata. Non-normative examples of a response from the <a class="reference internal" href="wallet-provider-endpoint.html#id1"><span class="std std-ref">Federation Endpoint</span></a> with the <strong>Entity Configuration</strong> and the <strong>Metadata</strong> of the Application Provider are presented within the <a class="reference internal" href="wallet-provider-entity-configuration.html#wallet-provider-entity-configuration"><span class="std std-ref">Wallet Provider Entity Configuration</span></a> and <a class="reference internal" href="relying-party-entity-configuration.html#entity-configuration-of-relying-parties"><span class="std std-ref">Entity Configuration of Relying Parties</span></a> sections.</p>
</div>
<p><strong>Steps 3-5 (Nonce Retrieval)</strong>: The Mobile Application Instance requests a one-time <code class="docutils literal notranslate"><span class="pre">nonce</span></code> from the <strong>Nonce Endpoint</strong> of the Application Provider Backend (see <a class="reference internal" href="wallet-provider-endpoint.html#wallet-solution-nonce-endpoint"><span class="std std-ref">Wallet Solution Nonce Endpoint</span></a> or <a class="reference internal" href="relying-party-endpoint.html#relying-party-nonce-endpoint"><span class="std std-ref">Relying Party Nonce Endpoint</span></a> ). This <code class="docutils literal notranslate"><span class="pre">nonce</span></code> MUST be unpredictable to serve as the main defense against replay attacks.</p>
<p>Upon a successful request, the Application Provider generates and returns the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> value to the Mobile Application Instance, as part of the <a class="reference internal" href="#mobile-application-nonce-response"><span class="std std-ref">Mobile Application Nonce Response</span></a>. The Application Provider MUST ensure that it is single-use and valid only within a specific time frame.</p>
<p><strong>Step 6</strong>: The Mobile Application Instance, through the operating system, creates a pair of Cryptographic Hardware Keys and stores the corresponding Cryptographic Hardware Key Tag in local storage once the following requirements are met:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It MUST ensure that Cryptographic Hardware Keys do not already exist. If they do exist and the Application Instance is in the initialization phase, they MUST be deleted.</p></li>
<li><p>It MUST generate a pair of asymmetric Elliptic Curve keys (<code class="docutils literal notranslate"><span class="pre">hardware_key_pub</span></code>, <code class="docutils literal notranslate"><span class="pre">hardware_key_priv</span></code>) via a local WSCD.</p></li>
<li><p>It SHOULD obtain a unique identifier Cryptographic Hardware Key Tag (<code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code>) for the generated Cryptographic Hardware Keys from the operating system. If the operating system permits specifying a tag during the creation of keys, then a random string for the <code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code> MUST be selected. This random value MUST be collision-resistant and unpredictable to ensure security. To achieve this, consider using a cryptographic hash function or a secure random number generator provided by the operating system or a reputable cryptographic library.</p></li>
<li><p>If the previous points are satisfied, it MUST store the <code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code> in local storage.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>WSCD</strong>: The Mobile Application Instance MAY use a local WSCD for cryptographic operations, including key generation, secure storage, and cryptographic processing, on devices that support this feature. On Android devices, Strongbox is RECOMMENDED; Trusted Execution Environment (TEE) MAY be used only when Strongbox is unavailable. For iOS devices, Secure Elements (SE) MUST be used. Given that each OEM offers a distinct SDK for accessing the local WSCD, the discussion hereafter will address this topic in a general context.</p>
<p>If the WSCD fails during any of these operations, for example due to hardware limitations, it will raise an error response to the Mobile Application Instance. The Mobile Application Instance MUST handle these errors accordingly to ensure secure operation. Details on error handling are left to the Mobile Application Instance implementation.</p>
</div>
<p><strong>Step 7</strong>: The Mobile Application Instance uses the Key Attestation API, providing the <code class="docutils literal notranslate"><span class="pre">client_data_hash</span></code> to acquire the Key Attestation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Key Attestation API</strong>: In this section, the Key Attestation API is assumed to be provided by device manufacturers. This service allows the verification of a key being securely stored within the device's hardware through a signed object. Additionally, it offers verifiable proof that a specific Mobile Application Instance is authentic, unaltered, and in its original state using a specialized signed document made for this purpose.</p>
<p>The service also incorporates details in the signed object, such as the device type, model, app version, operating system version, bootloader status, and other relevant information to assess whether the device has been compromised. For Android, the Key Attestation API is represented by <em>Key Attestation</em>, a feature supported by <em>StrongBox Keymaster</em>, which is a physical HSM installed directly on the motherboard, and the <em>TEE</em> (Trusted Execution Environment), a secure area of the main processor. <em>Key Attestation</em> aims to provide a way to strongly determine if a key pair is hardware-backed, what the properties of the key are, and what constraints are applied to its usage. Developers can leverage its functionality through the <em>Play Integrity API</em>. For Apple devices, the Key Attestation API is represented by <em>DeviceCheck</em>, which provides a framework and server interface to manage device-specific data securely. <em>DeviceCheck</em> is used in combination with the <em>Secure Enclave</em>, a dedicated HSM integrated into Apple's SoCs. <em>DeviceCheck</em> can be used to attest to the integrity of the device, apps, and/or encryption keys generated on the device, ensuring they were created in a secure environment like <em>Secure Enclave</em>. Developers can leverage <em>DeviceCheck</em> functionality by using the framework itself.
These services, specifically developed by the manufacturer, are integrated within the Android or iOS SDKs, eliminating the need for a predefined endpoint to access them. Additionally, as they are specifically developed for mobile architecture, they do not need to be registered as Federation Entities through national registration systems.
<em>Secure Enclave</em> has been available on Apple devices since the iPhone 5s (2013).
For Android devices, the inclusion of <strong>Strongbox Keymaster</strong> may vary by manufacturer, who decides whether to include it or not.</p>
</div>
<p>If any errors occur in the Key Attestation API process, such as device integrity verification, for example, due to unavailable Key Attestation APIs, an internal error, or an invalid nonce in the integrity request, the Key Attestation APIs raise an error response. The Mobile Application Instance MUST process these errors accordingly. Details on error handling are left to the Mobile Application Instance implementation.</p>
<p><strong>Step 8</strong>: The Key Attestation API performs the following actions:</p>
<ul class="simple">
<li><p>Creates a Key Attestation that is linked with the provided <code class="docutils literal notranslate"><span class="pre">client_data_hash</span></code> and the public key of the Application Instance Hardware.</p></li>
<li><p>Incorporates information pertaining to the device's security.</p></li>
<li><p>Uses an OEM private key to sign the Key Attestation, therefore verifiable with the related OEM certificate, confirming that the Cryptographic Hardware Keys are securely managed by the operating system.</p></li>
</ul>
<p><strong>Step 9 (Mobile Application Instance Initialization Request)</strong>: The Mobile Application Instance sends a <a class="reference internal" href="#mobile-application-instance-initialization-request"><span class="std std-ref">Mobile Application Instance Initialization Request</span></a> to the Application Provider, to initialize the Mobile Application Instance, identified by the Cryptographic Hardware Key public key. The request body includes the following claims: the <code class="docutils literal notranslate"><span class="pre">nonce</span></code>, Key Attestation (<code class="docutils literal notranslate"><span class="pre">key_attestation</span></code>), and Cryptographic Hardware Key Tag (<code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not necessary to send the Application Instance Hardware public key because it is already included in the <code class="docutils literal notranslate"><span class="pre">key_attestation</span></code>.
As seen in the previous steps, the Key Attestation API creates a Key Attestation linked to the provided <code class="docutils literal notranslate"><span class="pre">client_data_hash</span></code> which is the digest of the Application Provider's <code class="docutils literal notranslate"><span class="pre">nonce</span></code>, the public key of the Application Instance Hardware and its Hardware Key Tag. This process eliminates the need to send the Application Instance Hardware public key directly, as it is already included in the key attestation.</p>
</div>
<p><strong>Steps 10-12 (Mobile Application Instance Initialization Response)</strong>: The Application Provider validates the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> and <code class="docutils literal notranslate"><span class="pre">key_attestation</span></code> signature, therefore:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It MUST verify that the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> was generated by Application Provider and has not already been used.</p></li>
<li><p>It MUST validate the <code class="docutils literal notranslate"><span class="pre">key_attestation</span></code> as defined by the device manufacturers' guidelines. The Application Provider MUST also verify the binding between the received <code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code>, <code class="docutils literal notranslate"><span class="pre">hardware_key_pub</span></code> and <code class="docutils literal notranslate"><span class="pre">nonce</span></code> with the <code class="docutils literal notranslate"><span class="pre">client_data_hash</span></code> provided in the Key Attestation.</p></li>
<li><p>It MUST verify that the device in use has no security flaws and reflects the minimum security requirements defined by the Application Provider.</p></li>
<li><p>If these checks are passed, it MUST register the Mobile Application Instance, keeping the Cryptographic Hardware Key Tag (<code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code>), the Public Hardware Key (<code class="docutils literal notranslate"><span class="pre">hardware_key_pub</span></code>) and possibly other useful information related to the device.</p></li>
</ol>
</div></blockquote>
<p>Upon successful initialization of the Mobile Application Instance, the Application Provider responds with a confirmation of success (<a class="reference internal" href="#mobile-application-instance-initialization-response"><span class="std std-ref">Mobile Application Instance Initialization Response</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Application Provider might associate the Mobile Application Instance (through the <code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code> identifier) with a specific User or Device. This uniquely identifies the User/Device within the Application Provider's systems and can be used for future revocations in the lifecycle of the Mobile Application Instance.</p>
</div>
<p><strong>Steps 13-14</strong>: The Mobile Application Instance has been initialized.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Threat Model</strong>: while the initialization endpoint does not necessitate authenticating the client, it is safeguarded through the use of <cite>key_attestation</cite>. Proper validation of this attestation permits the initialization of authentic and unaltered app instances. Any other claims submitted will not undergo validation, leading the endpoint to respond with an error. Additionally, the inclusion of a nonce helps prevent replay attacks. The authenticity of both the nonce and the <code class="docutils literal notranslate"><span class="pre">hardware_key_tag</span></code> is ensured by the signature found within the <code class="docutils literal notranslate"><span class="pre">key_attestation</span></code>.</p>
</div>
<section id="mobile-application-nonce-request">
<h3><span class="section-number">22.1.1. </span>Mobile Application Nonce Request<a class="headerlink" href="#mobile-application-nonce-request" title="Link to this heading">¶</a></h3>
<p>The Nonce Request uses the HTTP GET method.</p>
<p>Below is a non-normative example of a Nonce Request.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/nonce</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">application-provider.example.com</span>
</pre></div>
</div>
</section>
<section id="mobile-application-nonce-response">
<h3><span class="section-number">22.1.2. </span>Mobile Application Nonce Response<a class="headerlink" href="#mobile-application-nonce-response" title="Link to this heading">¶</a></h3>
<p>Upon a successful request, the Application Provider returns an HTTP Response with a <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> status code, with <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> set to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
<p>The Nonce Response body contains the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> value.</p>
<p>Below is a non-normative example of a Nonce Response.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d2JhY2NhbG91cmVqdWFuZGFt&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="mobile-application-nonce-error-response">
<h4><span class="section-number">22.1.2.1. </span>Mobile Application Nonce Error Response<a class="headerlink" href="#mobile-application-nonce-error-response" title="Link to this heading">¶</a></h4>
<p>If any errors occur, the Application Provider returns an error response. The response uses <code class="docutils literal notranslate"><span class="pre">application/json</span></code> as the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> and includes the following parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>error</em>. The error code.</p></li>
<li><p><em>error_description</em>. Text in human-readable form providing further details to clarify the nature of the error encountered.</p></li>
</ul>
</div></blockquote>
<p>Below is a non-normative example of a Nonce Error Response.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">500</span> <span class="ne">Internal Server Error</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;server_error&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The server encountered an unexpected error.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following table lists HTTP Status Codes and related error codes that are supported for the error response:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 20.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>HTTP Status Code</strong></p></th>
<th class="head"><p><strong>Error Code</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>The request cannot be fulfilled because the Nonce Endpoint encountered an internal problem.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>The request cannot be fulfilled because the Nonce Endpoint is temporarily unavailable (e.g., due to maintenance or overload).</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="mobile-application-instance-initialization-request">
<h3><span class="section-number">22.1.3. </span>Mobile Application Instance Initialization Request<a class="headerlink" href="#mobile-application-instance-initialization-request" title="Link to this heading">¶</a></h3>
<p>The Instance Initialization Request uses the HTTP POST method with <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> set to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
<p>The Instance Initialization Request body contains the following claims:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 60.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Claim</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Reference</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>nonce</strong></p></td>
<td><p>It MUST be set to the value obtained from the Application Provider through the Nonce Endpoint.</p></td>
<td><p>This specification.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>hardware_key_tag</strong></p></td>
<td><p>The unique identifier of the <strong>Cryptographic Hardware Keys</strong> and encoded in <code class="docutils literal notranslate"><span class="pre">base64url</span></code>.</p></td>
<td><p>This specification.</p></td>
</tr>
<tr class="row-even"><td><p><strong>key_attestation</strong></p></td>
<td><p>An attestation that guarantees the secure generation, storage and usage of the key pair generated by the Mobile Application Instance. This can be an array containing a certificate chain whose leaf certificate is the Key Attestation obtained from the device <strong>Key Attestation APIs</strong>, signed with the device hardware key.</p></td>
<td><p>This specification.</p></td>
</tr>
</tbody>
</table>
<p>Below is a non-normative example of an Instance Initialization Request.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/instance-initialization</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">application-provider.example.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d2JhY2NhbG91cmVqdWFuZGFt&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;key_attestation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;o2NmbXRvYXBwbGUtYXBw... redacted&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hardware_key_tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WQhyDymFKsP95iFqpzdEDWW4l7aVna2Fn4JCeWHYtbU=&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mobile-application-instance-initialization-response">
<h3><span class="section-number">22.1.4. </span>Mobile Application Instance Initialization Response<a class="headerlink" href="#mobile-application-instance-initialization-response" title="Link to this heading">¶</a></h3>
<p>If an Instance Initialization Request is successfully validated, the Application Provider provides an HTTP Response with status code <code class="docutils literal notranslate"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code>.</p>
<p>Below is a non-normative example of an Instance Initialization Response.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No content</span>
</pre></div>
</div>
<section id="mobile-application-instance-initialization-error-response">
<h4><span class="section-number">22.1.4.1. </span>Mobile Application Instance Initialization Error Response<a class="headerlink" href="#mobile-application-instance-initialization-error-response" title="Link to this heading">¶</a></h4>
<p>If any errors occur, the Application Provider returns an error response. The response uses <code class="docutils literal notranslate"><span class="pre">application/json</span></code> as the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> and includes the following parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>error</em>. The error code.</p></li>
<li><p><em>error_description</em>. Text in human-readable form providing further details to clarify the nature of the error encountered.</p></li>
</ul>
</div></blockquote>
<p>Below is a non-normative example of an Instance Initialization Error Response.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-store</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;forbidden&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The provided nonce is invalid, expired, or already used.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following table lists HTTP Status Codes and related error codes that are supported for the error response:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 22.2%" />
<col style="width: 22.2%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>HTTP Status Code</strong></p></th>
<th class="head"><p><strong>Error Code</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bad_request</span></code></p></td>
<td><p>The request is malformed, missing required parameters, or includes invalid and unknown parameters.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrity_check_error</span></code></p></td>
<td><p>The device does not meet the Application Provider's minimum security requirements.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The provided nonce is invalid, expired, or already used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The signature of the Integrity Assertion is invalid.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">422</span> <span class="pre">Unprocessable</span> <span class="pre">Content</span></code> [OPTIONAL]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">validation_error</span></code></p></td>
<td><p>The request does not adhere to the required format.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>An internal error occurred while processing the request.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>The service is unavailable. Please try again later.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="mobile-application-key-binding">
<h2><span class="section-number">22.2. </span>Mobile Application Key Binding<a class="headerlink" href="#mobile-application-key-binding" title="Link to this heading">¶</a></h2>
<p>The Key Binding flow enables the Mobile Application Instance to bind a newly created pair of keys to the Mobile Application Instance, by relying on a proof of possession of the Cryptographic Hardware Keys generated during the <a class="reference internal" href="#mobile-application-instance-initialization"><span class="std std-ref">Mobile Application Instance Initialization</span></a> phase. Before completing the process, the Application Provider also needs to verify the integrity of the Mobile Application Instance.</p>
<p>Although the exact flow differs depending on the context (see the <a class="reference internal" href="relying-party-instance.html#mobile-relying-party-instance-registration"><span class="std std-ref">Mobile Relying Party Instance Registration</span></a> and <a class="reference internal" href="wallet-attestation-issuance.html#id1"><span class="std std-ref">Wallet Attestation Issuance</span></a> sections), the Mobile Application Integrity Request and Error Response are consistent.</p>
<section id="mobile-application-key-binding-request">
<h3><span class="section-number">22.2.1. </span>Mobile Application Key Binding Request<a class="headerlink" href="#mobile-application-key-binding-request" title="Link to this heading">¶</a></h3>
<p>The Key Binding Request uses the HTTP POST method with <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> set to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
<p>The Key Binding Request body contains an <code class="docutils literal notranslate"><span class="pre">assertion</span></code> parameter whose value is a signed JWT including all header parameters and body claims described below.</p>
<p>Below is a non-normative example of a Key Binding Request.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/key-binding</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">application-provider.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;assertion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJFUzI1NiIsImtpZCI6ImtoakZWTE9nRjNHeG...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In particular, the Key Binding Request JWT includes the following HTTP header parameters:</p>
<table class="longtable docutils align-default" id="table-key-binding-request-claim">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 60.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Reference</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>alg</strong></p></td>
<td><p>A digital signature algorithm identifier such as per IANA &quot;JSON Web Signature and Encryption Algorithms&quot; registry. It MUST be one of the supported algorithms listed in the <a class="reference internal" href="algorithms.html#cryptographic-algorithms"><span class="std std-ref">Cryptographic Algorithms</span></a> and MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">none</span></code> or any symmetric algorithm (MAC) identifier.</p></td>
<td><p>[<span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7516.html#section-4.1.1"><strong>RFC 7516#section-4.1.1</strong></a>]</p></td>
</tr>
<tr class="row-odd"><td><p><strong>kid</strong></p></td>
<td><p>Thumbprint of the Mobile Application Instance's JWK contained in the <code class="docutils literal notranslate"><span class="pre">cnf</span></code> claim.</p></td>
<td><p>[<span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7638.html#section_3"><strong>RFC 7638#section_3</strong></a>]</p></td>
</tr>
<tr class="row-even"><td><p><strong>typ</strong></p></td>
<td><p>The type of the JWT, which can assume different values depending on the context.</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The Key Binding Request JWT includes the following body claims:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 60.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Claim</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Reference</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>iss</strong></p></td>
<td><p>The identifier of the Application Provider concatenated with the thumbprint of the JWK in the <code class="docutils literal notranslate"><span class="pre">cnf</span></code> claim.</p></td>
<td><p>[<span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9126.html"><strong>RFC 9126</strong></a>], [<span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7519.html"><strong>RFC 7519</strong></a>].</p></td>
</tr>
<tr class="row-odd"><td><p><strong>aud</strong></p></td>
<td><p>The identifier of the Application Provider.</p></td>
<td><p>[<span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9126.html"><strong>RFC 9126</strong></a>], [<span class="target" id="index-5"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7519.html"><strong>RFC 7519</strong></a>].</p></td>
</tr>
<tr class="row-even"><td><p><strong>exp</strong></p></td>
<td><p>UNIX timestamp representing the JWT expiration time.</p></td>
<td><p>[<span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9126.html"><strong>RFC 9126</strong></a>], [<span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7519.html"><strong>RFC 7519</strong></a>].</p></td>
</tr>
<tr class="row-odd"><td><p><strong>iat</strong></p></td>
<td><p>UNIX timestamp representing the JWT issuance time.</p></td>
<td><p>[<span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9126.html"><strong>RFC 9126</strong></a>], [<span class="target" id="index-9"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7519.html"><strong>RFC 7519</strong></a>].</p></td>
</tr>
<tr class="row-even"><td><p><strong>nonce</strong></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">nonce</span></code> obtained from the Nonce Endpoint.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>hardware_signature</strong></p></td>
<td><p>The signature of <code class="docutils literal notranslate"><span class="pre">client_data</span></code> obtained using the Cryptographic Hardware Key, encoded in the <code class="docutils literal notranslate"><span class="pre">base64url</span></code> format.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>key_attestation</strong></p></td>
<td><p>The key attestation obtained from the Key Attestation APIs with the holder binding of <code class="docutils literal notranslate"><span class="pre">client_data</span></code>.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>hardware_key_tag</strong></p></td>
<td><p>The value of the Cryptographic Hardware Key Tag.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>cnf</strong></p></td>
<td><p>JSON object containing the public part of an asymmetric key pair owned by the Mobile Application Instance.</p></td>
<td><p><span class="target" id="index-10"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7800.html"><strong>RFC 7800</strong></a>.</p></td>
</tr>
</tbody>
</table>
<p>Below is a non-normative example of a Key Binding Request JWT header and payload.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES256&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hT3v7KQjFZy6GvDkYgOZ1u2F6T4Nz5bPjX8o1MZ3dJY&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://application-provider.example.org/instance/hT3v7KQjFZy6GvDkYgOZ1u2F6T4Nz5bPjX8o1MZ3dJY&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://application-provider.example.org/&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;f3b29a81-45c7-4d12-b8b5-e1f6c9327aef&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hardware_signature&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KoZIhvcNAQcCoIAwgAIB...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;key_attestation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;o2NmbXRvYXBwbGUtYXBwYXNzZXJ0aW9uLXBheWxvYWQtYXBw...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hardware_key_tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;QW12DylRTmF89iGkpydNDWW7m8bVpa2Fn9KBeXGYtfX&quot;</span>
<span class="w">  </span><span class="nt">&quot;cnf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;jwk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;crv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P-256&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EC&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8FJtI-yr3pjyRKGMnz4WmdnQD_uJSq4R95Nj98b44&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MKZnSB39vFJhYgS3k7jXE4r3-CoGFQwZtPBIRqpNlrg&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mobile-application-key-binding-response">
<h3><span class="section-number">22.2.2. </span>Mobile Application Key Binding Response<a class="headerlink" href="#mobile-application-key-binding-response" title="Link to this heading">¶</a></h3>
<p>The Key Binding Response strictly depends on the context of the request; further details are provided in the <a class="reference internal" href="relying-party-endpoint.html#relying-party-key-binding-response"><span class="std std-ref">Relying Party Key Binding Response</span></a> and <a class="reference internal" href="wallet-provider-endpoint.html#wallet-attestation-issuance-response"><span class="std std-ref">Wallet Attestation Issuance Response</span></a> sections.</p>
<section id="mobile-application-key-binding-error-response">
<h4><span class="section-number">22.2.2.1. </span>Mobile Application Key Binding Error Response<a class="headerlink" href="#mobile-application-key-binding-error-response" title="Link to this heading">¶</a></h4>
<p>If any errors occur, the Application Provider returns an error response. The response uses <code class="docutils literal notranslate"><span class="pre">application/json</span></code> as the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> and includes the following parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>error</em>. The error code.</p></li>
<li><p><em>error_description</em>. Text in human-readable form providing further details to clarify the nature of the error encountered.</p></li>
</ul>
</div></blockquote>
<p>Below is a non-normative example of a Key Binding Error Response.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;invalid_request&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The provided challenge is invalid, expired, or already used.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following table lists HTTP Status Codes and related error codes that are supported for the error response, unless otherwise specified:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 20.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>HTTP Status Code</strong></p></th>
<th class="head"><p><strong>Error Code</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bad_request</span></code></p></td>
<td><p>The request is malformed, missing required parameters (e.g., header parameters or integrity assertion), or includes invalid and unknown parameters.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The Mobile Application Instance has been revoked.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrity_check_error</span></code></p></td>
<td><p>The device does not meet the Application Provider's minimum security requirements.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The signature of the Integrity Request is invalid or does not match the associated public key (JWK).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The integrity assertion validation failed; the integrity assertion is tampered with or improperly signed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The provided <code class="docutils literal notranslate"><span class="pre">nonce</span></code> is invalid, expired, or already used.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The Proof of Possession (<code class="docutils literal notranslate"><span class="pre">hardware_signature</span></code>) is invalid.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">iss</span></code> parameter does not match the Application Provider's expected URL identifier.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">not_found</span></code></p></td>
<td><p>The Mobile Application Instance was not found.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">422</span> <span class="pre">Unprocessable</span> <span class="pre">Content</span></code> [OPTIONAL]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">validation_error</span></code></p></td>
<td><p>The request does not adhere to the required format.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>An internal server error occurred while processing the request.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>The service is unavailable. Please try again later.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">22. Mobile Application Instance</a><ul>
<li><a class="reference internal" href="#mobile-application-instance-initialization">22.1. Mobile Application Instance Initialization</a><ul>
<li><a class="reference internal" href="#mobile-application-nonce-request">22.1.1. Mobile Application Nonce Request</a></li>
<li><a class="reference internal" href="#mobile-application-nonce-response">22.1.2. Mobile Application Nonce Response</a><ul>
<li><a class="reference internal" href="#mobile-application-nonce-error-response">22.1.2.1. Mobile Application Nonce Error Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mobile-application-instance-initialization-request">22.1.3. Mobile Application Instance Initialization Request</a></li>
<li><a class="reference internal" href="#mobile-application-instance-initialization-response">22.1.4. Mobile Application Instance Initialization Response</a><ul>
<li><a class="reference internal" href="#mobile-application-instance-initialization-error-response">22.1.4.1. Mobile Application Instance Initialization Error Response</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#mobile-application-key-binding">22.2. Mobile Application Key Binding</a><ul>
<li><a class="reference internal" href="#mobile-application-key-binding-request">22.2.1. Mobile Application Key Binding Request</a></li>
<li><a class="reference internal" href="#mobile-application-key-binding-response">22.2.2. Mobile Application Key Binding Response</a><ul>
<li><a class="reference internal" href="#mobile-application-key-binding-error-response">22.2.2.1. Mobile Application Key Binding Error Response</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="e-service-pdnd.html">
                    <span class="icon">&lt;</span><span><span class="section-number">21. </span>e-Service PDND</span></a>
                
            </div>

            <div class="right">
                
                    <a href="entity-configurations.html"><span><span class="section-number">23. </span>Entity Configurations</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
      Last updated on 08/05/2025.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.5.
    </div>

<p id="theme_credit"></p>
  </body>
</html>